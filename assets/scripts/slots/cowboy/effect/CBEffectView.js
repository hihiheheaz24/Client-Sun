/*
 * Generated by BeChicken
 * on 11/6/2019
 * version v1.0
 */
(function () {
    cc.CBEffectView = cc.Class({
        extends: cc.EffectView,
        properties: {
            nodeReward: cc.Node,
            particleReward: cc.ParticleSystem,
            lbReward: cc.LabelIncrement,
            animationReward: cc.Animation,
            nodeFreeSpinNoti: cc.Node,
        },

        onLoad: function () {
            this._super();
            this.scheduler = cc.director.getScheduler();
            this.animationReward = this.nodeReward.getComponent(cc.Animation);
            this.animationFreeSpinNoti = this.nodeFreeSpinNoti.getComponent(cc.Animation);
        },


        playEffect: function (effectType, totalWin, tweenTime) {
            this.nodeJackpot.active = false;
            this.nodeBigWin.active = false;
            this.nodeNormalWin.active = false;
            this.nodeReward.active = false;
            this.nodeFreeSpinNoti.active = false;
            switch (effectType) {
                case cc.EffectType.JACKPOT:
                    this.nodeJackpot.active = true;
                    let animMain = this.animationJackpot.play('cbOpenWinJP');
                    const nodeTitle = this.nodeJackpot.getChildByName("TL_ani");
                    animMain.off('finished');
                    animMain.on('finished', () => {
                        nodeTitle.stopAllActions();
                        nodeTitle.runAction(cc.repeatForever(cc.sequence(cc.scaleTo(0.2, 0.9), cc.scaleTo(0.2, 1))));
                    });
                    this.particleJackpot.resetSystem();
                    this.lbiTotalWins[0].setValue(0);
                    this.lbiTotalWins[0].tweenValueto(totalWin, tweenTime);

                    this.scheduler.schedule(function () {
                        nodeTitle.stopAllActions();
                        this.nodeFreeSpinNoti.active = false;
                        this.particleJackpot.resetSystem();
                        this.lbiTotalWins[0].setValue(0);
                        this.nodeJackpot.active = false;
                    }, this, 0, 0, 5, false);
                    break;
                case cc.EffectType.BIG_WIN:
                    this.nodeBigWin.active = true;
                    this.nodeBigWin.opacity = 0;
                    this.nodeBigWin.runAction(cc.fadeIn(0.3))
                    this.animationBigWin.stop();
                    this.animationBigWin.play();
                    this.particleBigWin.resetSystem();
                    this.lbiTotalWins[1].setValue(0);
                    this.lbiTotalWins[1].tweenValueto(totalWin, tweenTime);
                    break;
                case cc.EffectType.NORMAL_WIN:
                    this.nodeNormalWin.active = true;
                    this.animationWin.play();
                    this.particleWin.resetSystem();
                    this.lbiTotalWins[2].setValue(0);
                    this.lbiTotalWins[2].tweenValueto(totalWin, tweenTime);
                    break;
                case cc.EffectType.SUPER_WIN:
                    this.nodeReward.active = true;
                    this.animationReward.play();
                    this.particleReward.resetSystem();
                    this.lbReward.setValue(0);
                    this.lbReward.tweenValueto(totalWin, tweenTime);

                    this.scheduler.schedule(function () {
                        this.nodeReward.active = false;
                    }, this, 0, 0, 3, false);
                    break;
                case cc.EffectType.FREE_SPIN_NOTI:
                    this.nodeFreeSpinNoti.active = true;
                    this.animationFreeSpinNoti.play();
                    this.scheduler.schedule(function () {
                        this.nodeFreeSpinNoti.active = false;
                    }, this, 0, 0, tweenTime - 0.2, false);

                    break;       
            }
            this.nodeEffect.active = true;
        },

        stopEffect: function () {
            this.unscheduleAllCallbacks();
            const nodeTitle = this.nodeJackpot.getChildByName("TL_ani");
            nodeTitle.stopAllActions()
            this.nodeEffect.active = false;
        },

    })
}).call(this);